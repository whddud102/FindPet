<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="X-UA-Compatible" content="IE = edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="ContentTye" content="text/html; charset=utf-8">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
	integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
	crossorigin="anonymous">

<style type="text/css">
@import
	url('https://fonts.googleapis.com/css2?family=Gaegu:wght@700&display=swap');

@import url('https://fonts.googleapis.com/css?family=Do+Hyeon:400');
</style>

<title>유기동물 검색</title>
</head>
<body>
	<div class="container-fluid d-flex flex-column min-vh-100">

	
		<!-- Header -->
		<div class="sticky-top">
			<div th:insert="~{fragments/header::header}"></div>
		</div>
		<!-- /Header -->		

		<!-- Main Row -->
		<div id="main_row" class="row p-3 d-flex justify-content-center align-items-center flex-row min-vh-100">
			<div class="col-8">
				<div class="card">
					<div class="card-header">
						<div class="d-sm-inline">
							<span class="font-weight-bold h4">게시글 조회</span>
						</div>
						<div class="d-sm-inline float-sm-right">
							<!-- Button trigger modal -->
							<button type="button" id="btn_modify" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal">수정하기</button>
							<button type="button" id="btn_remove" class="btn btn-danger btn-sm" data-toggle="modal"	data-target="#myModal">삭제</button>
						</div>
					</div>
					<div class="card-body">
						<div class="row">
							<div class="col">
								<span class="font-weight-bold float-left" id="title" th:text="${board.title}"></span>
							</div>
						</div>
						<div class="row">
							<div class="col">
								<div class="d-md-inline float-md-left">
									
									<span th:text="${board.nickname}" class="mr-1"></span> | 
									<span th:text="${#temporals.format(board.created_datetime, 'yyyy-MM-dd HH:mm')}" class="ml-1"></span>
									
								</div>
								<div class="d-md-inline float-md-right">
									조회수&nbsp; <span th:text="${board.hit_cnt}" class="mr-1"></span>
									| 댓글&nbsp; <span th:text="${board.hit_cnt}"></span>
								</div>
							</div>
						</div>
						
						<div class="row">
							<div class="col">
								<hr>
								<p th:text="${board.contents}">
							</div>
						
						</div>
						
					</div>
					<!-- /.card body -->
				</div>
				<!-- card -->
			</div>
			<!-- col -->
		</div>
		<!-- /.Main Row -->
		
	
		<!-- Footer -->
		<div th:insert="~{fragments/footer::footer}"></div>
		
		<!-- hidden form for info -->
		<form id="action_form" class="d-none" method="GET">
			<input type="hidden" id="bno" name="bno" th:value="${board.bno}">
			<input type="hidden" id="encrypted_password" name="encrypted_password">
		</form>
		<!-- /hidden form -->
		

		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="modalCenterTitle" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="modalLongTitle">비밀번호</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<input id="password" type="password" class="form-control" minlength="4" maxlength="4" required="required">
					</div>
					<div class="modal-footer">
						<button id="btn_close" type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
						<button id="btn_ok" type="button" class="btn btn-primary">확인</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal -->

	</div>
	<!-- /.Container -->

	<!-- Boot Strap -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
		integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
		crossorigin="anonymous"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
		crossorigin="anonymous"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
 	<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.js"></script>

	<script
		src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
		integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
		crossorigin="anonymous"></script>


	<!-- Pagination 출력 함수  -->
 	<script th:src="@{/js/makePagination.js}"></script>
 	<!-- /makePagination -->
 	
	<script th:inline="javascript">
	$(document).ready(function() {
		var password = $("#password");
		var action_form = $("#action_form");
		
		$('#btn_modify').on('click', function() {
			$('#myModal').modal('show');
			action_form.attr("action", "/board/modify");
			password.focus();			
		});
		
		$('#btn_remove').on('click', function() {
			$('#myModal').modal('show');
			action_form.attr("action", "/board/remove");
			action_form.attr("method", "post");
			password.focus();
		});
		
		$('#btn_ok').on('click', function() {
			if(password.val().length != 4) {
				alert("비밀번호 4자리를 모두 입력해주세요");
				password.focus();
			} else {
				$.ajax({
					type : 'post',
					url : '/api/encrypt',
					data : JSON.stringify({"password" : password.val(), "bno" : $("#bno").val()}),
					contentType : "application/json; charset=utf-8",
					success : function(result, status, xhr) {
						if(result != "false") {
							$("#encrypted_password").val(result);							
							$('#myModal').modal('hide');
							
							action_form.submit();
						} else {
							password.val("");
							alert("비밀번호가 일치하지 않습니다");
							password.focus();
						}
					},
					error: function(xhr, status, error) {
						console.log("비밀번호 암호화 요청 실패....");
					}
				});
			}
		});
		
		$('#btn_close').on('click', function() {
			$('#myModal').modal('hide');
			password.val("");
			console.log("modal close");
		});
	});
	</script>
</body>
</html>


